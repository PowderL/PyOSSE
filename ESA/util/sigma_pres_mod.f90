SUBROUTINE get_model_pres(nx, ny, nz, ps, ap, bp,pres, pres_edge)
  ! Caclulate (hybrid-sigma) pressure at model levels from surface pressure 
  !
  ! Inputs: 
  ! 1,2. integer*4:: nx, ny #size of ps  ----in----- array of M  surface pressure in hPa
  ! 3. integer*4:: nz  #the vertical level
  ! 4, 5. real*8:: a(nz), b(nz) #coefficents for pressures at model levels. 
  !               p_edge(l)=a(l)+b(l)*ps
  ! 6: real*8:: ps(nx, ny)  #surface pressure in hPa
  !
  ! Outputs:
  ! 1. real*8::pres(nx, ny, nz-1)  # pressure at model level (hPa)
  !      pres(ix, jy, l)=0.5*(pres_edge(ix, jy, l)+pres_edge(ix, jy, l+1))
  ! 2. real*8::pres_edge(nx, ny, nz)  #pressure at model level edges (hPa)
  
  
  
  IMPLICIT NONE
  integer*4, intent(in)::nx, ny, nz
  real*8, intent(in)::ps(nx, ny)
  real*8, intent(in)::ap(nz), bp(nz)
  real*8, intent(out)::pres(nx, ny, nz-1), pres_edge(nx, ny, nz)
  
  ! local variables
  INTEGER::IX, JY, L
  
  DO IX=1, NX
     DO JY=1, NY
        DO L=1, NZ
           pres_edge(IX, JY, L) = ap(L) + bp(L) * PS(IX, JY)
           
        END DO
     END DO
  END DO
  
  DO IX=1, NX
     DO JY=1, NY
        DO L=1, NZ-1
           pres(IX, JY, L)=0.5*(pres_edge(IX,JY, L)+pres_edge(IX,JY, L+1))
        END DO
     END DO
  END DO
  
  
END SUBROUTINE get_model_pres


SUBROUTINE get_gc_ap_bp(MODETYPE,REDUCED_LVL, nlvl, ap, bp)
  ! Get GC-Chem AP, BP for model level pressure  
  ! Inputs:
  !  1. integer*4::MODELTYPE # model type 
  !     4--GEOS4 ; 5-GEOS5 
  !  2. inetger*4::REDUCED_LVL  # 1--use full levels 
  !
  ! Outputs:
  !  1. Integer*4::nlvl  # levels of model  
  !  2, 3. real*8::ap(300), bp(300) # coefficient ap and bp for GEOS  
  
  IMPLICIT NONE
  
  INTEGER*4, INTENT(IN)::MODETYPE
  INTEGER*4, INTENT(IN)::REDUCED_LVL
  REAL*8, intent(out) ::AP(300), BP(300)
  integer*4, intent(out)::nlvl
  
     
  IF  (MODETYPE==5 ) THEN 
     
     !=================================================================
     ! GEOS-5 vertical coordinates (47 or 72 levels)
     !=================================================================
     
     if (REDUCED_LVL==1) THEN 
        nlvl=48
        
        !-----------------------------------
        ! GEOS-5 47 level grid
        !  
        !  level  Edge     # L's
        !  edge   Prs hPa  lumped
        !  
        !    48     0.0100 (4)
        !    47     0.0660 (4)
        !    46     0.2113 (4)
        !    45     0.6168 (4)
        !    44     1.6508 (4)
        !    43     4.0766 (4)
        !    42     9.2929 (4)
        !    41    19.7916 (2)
        !    40    28.3678 (2)
        !    39    40.1754 (2)
        !    38    56.3879 (2)
        ! -- keep levels below this line --
        !    37    78.5123 
        !    36    92.3657
        !-----------------------------------
        
        ! Ap [hPa] for 47 levels (48 edges)
        AP(1:48) = (/ 0.000000d+00, 4.804826d-02, 6.593752d+00, 1.313480d+01,  &
             1.961311d+01, 2.609201d+01, 3.257081d+01, 3.898201d+01,     &  
             4.533901d+01, 5.169611d+01, 5.805321d+01, 6.436264d+01,     & 
             7.062198d+01, 7.883422d+01, 8.909992d+01, 9.936521d+01,     & 
             1.091817d+02, 1.189586d+02, 1.286959d+02, 1.429100d+02,     & 
             1.562600d+02, 1.696090d+02, 1.816190d+02, 1.930970d+02,     &
             2.032590d+02, 2.121500d+02, 2.187760d+02, 2.238980d+02,     &
             2.243630d+02, 2.168650d+02, 2.011920d+02, 1.769300d+02,     &
             1.503930d+02, 1.278370d+02, 1.086630d+02, 9.236572d+01,     &
             7.851231d+01, 5.638791d+01, 4.017541d+01, 2.836781d+01,      & 
             1.979160d+01, 9.292942d+00, 4.076571d+00, 1.650790d+00,      & 
             6.167791d-01, 2.113490d-01, 6.600001d-02, 1.000000d-02 /)
        
        ! Bp [unitless] for 47 levels (48 edges)
        BP(1:48) = (/ 1.000000d+00, 9.849520d-01, 9.634060d-01, 9.418650d-01,   & 
             9.203870d-01, 8.989080d-01, 8.774290d-01, 8.560180d-01,     &   
             8.346609d-01, 8.133039d-01, 7.919469d-01, 7.706375d-01,     & 
             7.493782d-01, 7.211660d-01, 6.858999d-01, 6.506349d-01,     &
             6.158184d-01, 5.810415d-01, 5.463042d-01, 4.945902d-01,     & 
             4.437402d-01, 3.928911d-01, 3.433811d-01, 2.944031d-01,     & 
             2.467411d-01, 2.003501d-01, 1.562241d-01, 1.136021d-01,     & 
             6.372006d-02, 2.801004d-02, 6.960025d-03, 8.175413d-09,     & 
             0.000000d+00, 0.000000d+00, 0.000000d+00, 0.000000d+00,     & 
             0.000000d+00, 0.000000d+00, 0.000000d+00, 0.000000d+00,     & 
             0.000000d+00, 0.000000d+00, 0.000000d+00, 0.000000d+00,     &
             0.000000d+00, 0.000000d+00, 0.000000d+00, 0.000000d+00 /)
        
     ELSE
        
        !--------------------------------
        ! GEOS-5 72 level grid
        !--------------------------------
        nlvl=73
        ! Ap [hPa] for 72 levels (73 edges)
        AP(1:73) = (/ 0.000000d+00, 4.804826d-02, 6.593752d+00, 1.313480d+01,      &
             1.961311d+01, 2.609201d+01, 3.257081d+01, 3.898201d+01,       &
             4.533901d+01, 5.169611d+01, 5.805321d+01, 6.436264d+01,     & 
             7.062198d+01, 7.883422d+01, 8.909992d+01, 9.936521d+01,     & 
             1.091817d+02, 1.189586d+02, 1.286959d+02, 1.429100d+02,     & 
             1.562600d+02, 1.696090d+02, 1.816190d+02, 1.930970d+02,     & 
             2.032590d+02, 2.121500d+02, 2.187760d+02, 2.238980d+02,     &
             2.243630d+02, 2.168650d+02, 2.011920d+02, 1.769300d+02,     & 
             1.503930d+02, 1.278370d+02, 1.086630d+02, 9.236572d+01,     & 
             7.851231d+01, 6.660341d+01, 5.638791d+01, 4.764391d+01,     & 
             4.017541d+01, 3.381001d+01, 2.836781d+01, 2.373041d+01,     & 
             1.979160d+01, 1.645710d+01, 1.364340d+01, 1.127690d+01,     &  
             9.292942d+00, 7.619842d+00, 6.216801d+00, 5.046801d+00,     & 
             4.076571d+00, 3.276431d+00, 2.620211d+00, 2.084970d+00,     &   
             1.650790d+00, 1.300510d+00, 1.019440d+00, 7.951341d-01,     &
             6.167791d-01, 4.758061d-01, 3.650411d-01, 2.785261d-01,     & 
             2.113490d-01, 1.594950d-01, 1.197030d-01, 8.934502d-02,     &
             6.600001d-02, 4.758501d-02, 3.270000d-02, 2.000000d-02,     &
             1.000000d-02 /)
        
        ! Bp [unitless] for 72 levels (73 edges)
        BP(1:73) = (/ 1.000000d+00, 9.849520d-01, 9.634060d-01, 9.418650d-01,     &
             9.203870d-01, 8.989080d-01, 8.774290d-01, 8.560180d-01,     & 
             8.346609d-01, 8.133039d-01, 7.919469d-01, 7.706375d-01,     & 
             7.493782d-01, 7.211660d-01, 6.858999d-01, 6.506349d-01,     &
             6.158184d-01, 5.810415d-01, 5.463042d-01, 4.945902d-01,     & 
             4.437402d-01, 3.928911d-01, 3.433811d-01, 2.944031d-01,     &
             2.467411d-01, 2.003501d-01, 1.562241d-01, 1.136021d-01,     &
             6.372006d-02, 2.801004d-02, 6.960025d-03, 8.175413d-09,     &
             0.000000d+00, 0.000000d+00, 0.000000d+00, 0.000000d+00,     &
             0.000000d+00, 0.000000d+00, 0.000000d+00, 0.000000d+00,     &
             0.000000d+00, 0.000000d+00, 0.000000d+00, 0.000000d+00,     &  
             0.000000d+00, 0.000000d+00, 0.000000d+00, 0.000000d+00,     &
             0.000000d+00, 0.000000d+00, 0.000000d+00, 0.000000d+00,     &  
             0.000000d+00, 0.000000d+00, 0.000000d+00, 0.000000d+00,     &
             0.000000d+00, 0.000000d+00, 0.000000d+00, 0.000000d+00,     &
             0.000000d+00, 0.000000d+00, 0.000000d+00, 0.000000d+00,     &
             0.000000d+00, 0.000000d+00, 0.000000d+00, 0.000000d+00,     &
             0.000000d+00, 0.000000d+00, 0.000000d+00, 0.000000d+00,     &
             0.000000d+00 /)
        
     END IF
  
     
  ELSE IF (MODETYPE==4) THEN 
     
     IF  (REDUCED_LVL==1) THEN  
        nlvl=31
        !-----------------------------------
        ! GEOS-4 30 level grid
        !  
        !  level  Edge     # L's
        !  edge   Prs hPa  lumped
        !  
        !    48     0.0100 (4)
        !    47     0.0660 (4)
        !    46     0.2113 (4)
        !    45     0.6168 (4)
        !    44     1.6508 (4)
        !    43     4.0766 (4)
        !    42     9.2929 (4)
        !    41    19.7916 (2)
        !    40    28.3678 (2)
        !    39    40.1754 (2)
        !    38    56.3879 (2)
        ! -- keep levels below this line --
        !    37    78.5123 
        !    36    92.3657
        !-----------------------------------
        
        ! Ap [hPa] for 30 levels (31 edges)
        AP(1:31) = (/  0.000000d0,   0.000000d0,  12.704939d0,  35.465965d0,      &
             66.098427d0, 101.671654d0, 138.744400d0, 173.403183d0,      &   
             198.737839d0, 215.417526d0, 223.884689d0, 224.362869d0,      & 
             216.864929d0, 201.192093d0, 176.929993d0, 150.393005d0,      &
             127.837006d0, 108.663429d0,  92.365662d0,  78.512299d0,      &
             56.387939d0,  40.175419d0,  28.367815d0,  19.791553d0,      & 
             9.292943d0,   4.076567d0,   1.650792d0,   0.616779d0,      &
             0.211349d0,   0.066000d0,   0.010000d0 /)
        
        ! Bp [unitless] for 30 levels (31 edges)
        BP(1:31) = (/  1.000000d0,   0.985110d0,   0.943290d0,   0.867830d0,     &
             0.764920d0,   0.642710d0,   0.510460d0,   0.378440d0,      &
             0.270330d0,   0.183300d0,   0.115030d0,   0.063720d0,     &
             0.028010d0,   0.006960d0,   0.000000d0,   0.000000d0,      &
             0.000000d0,   0.000000d0,   0.000000d0,   0.000000d0,     &
             0.000000d0,   0.000000d0,   0.000000d0,   0.000000d0,      & 
             0.000000d0,   0.000000d0,   0.000000d0,   0.000000d0,     & 
             0.000000d0,   0.000000d0,   0.000000d0 /)
        
     ELSE
        nlvl=56
        !-----------------------------------
        ! GEOS-4 55 level grid
        !-----------------------------------
        
        ! AP [hPa] for 55 levels (56 edges)
        AP(1:56) = (/ 0.000000d0,   0.000000d0,  12.704939d0,  35.465965d0,      &
             66.098427d0, 101.671654d0, 138.744400d0, 173.403183d0,     & 
             198.737839d0, 215.417526d0, 223.884689d0, 224.362869d0,     &
             216.864929d0, 201.192093d0, 176.929993d0, 150.393005d0,     &
             127.837006d0, 108.663429d0,  92.365662d0,  78.512299d0,      &
             66.603378d0,  56.387939d0,  47.643932d0,  40.175419d0,      &
             33.809956d0,  28.367815d0,  23.730362d0,  19.791553d0,      &
             16.457071d0,  13.643393d0,  11.276889d0,   9.292943d0,     &
             7.619839d0,   6.216800d0,   5.046805d0,   4.076567d0,      &
             3.276433d0,   2.620212d0,   2.084972d0,   1.650792d0,     &
             1.300508d0,   1.019442d0,   0.795134d0,   0.616779d0,      &
             0.475806d0,   0.365041d0,   0.278526d0,   0.211349d0,      & 
             0.159495d0,   0.119703d0,   0.089345d0,   0.066000d0,      & 
             0.047585d0,   0.032700d0,   0.020000d0,   0.010000d0 /)
        
        ! BP [unitless] for 55 levels (56 edges)
        BP(1:56) = (/  1.000000d0,  0.985110d0,   0.943290d0,   0.867830d0,     &
             0.764920d0,  0.642710d0,   0.510460d0,   0.378440d0,     & 
             0.270330d0,  0.183300d0,   0.115030d0,   0.063720d0,     &
             0.028010d0,  0.006960d0,   0.000000d0,   0.000000d0,     & 
             0.000000d0,  0.000000d0,   0.000000d0,   0.000000d0,     &
             0.000000d0,  0.000000d0,   0.000000d0,   0.000000d0,     &
             0.000000d0,  0.000000d0,   0.000000d0,   0.000000d0,     &
             0.000000d0,  0.000000d0,   0.000000d0,   0.000000d0,     &
             0.000000d0,  0.000000d0,   0.000000d0,   0.000000d0,     & 
             0.000000d0,  0.000000d0,   0.000000d0,   0.000000d0,     &
             0.000000d0,  0.000000d0,   0.000000d0,   0.000000d0,     &
             0.000000d0,  0.000000d0,   0.000000d0,   0.000000d0,     &
             0.000000d0,  0.000000d0,   0.000000d0,   0.000000d0,     &
             0.000000d0,  0.000000d0,   0.000000d0,   0.000000d0 /)
        
        
     ENDIF
  ENDIF

END SUBROUTINE GET_GC_AP_BP

